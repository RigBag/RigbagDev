RigBagQa=function(){this.searchParams={query:"",lastCall:false}};RigBagQa.prototype.search=function(){var b,c;if($("body").hasClass("circles")){b="circles"}else{b="main"}if(b=="circles"){c={query:$("#searchQuery").val(),circle:$(".circles-sidebar li.active").attr("data-id"),type:b}}else{c={query:$("#searchQuery").val(),category:$("#searchCategory").val(),type:b}}rbApp.actionStamp=new Date().getTime();c.actionStamp=rbApp.actionStamp;var a=false;if(c.query.length>2){a=true}else{if(this.searchParams.query.length>c.query.length&&this.searchParams.lastCall){a=true}}if(a){showLoader();this.searchParams.lastCall=a;this.searchParams.query=c.query;$.ajax({type:"POST",url:APP_PATH+"q-and-a/search/",data:c,cache:false,dataType:"json",success:function(d){hideLoader();if(rbApp.actionStamp==d.actionStamp){if(b==="circles"){$("#circle-content").html(d.content)}else{$("#qa-list").html(d.content)}}}})}};RigBagQa.prototype.remove=function(d,b,a){var c={id:d};$.ajax({type:"POST",url:APP_PATH+"q-and-a/delete/",data:c,cache:false,dataType:"json",success:function(e){switch(b){case"call-action":rbApp.callAction(a);break;case"fade-out":$(a).fadeOut();break}}})};RigBagQa.prototype.answersRefresh=function(){var a={qid:$("#qid").val()};$.ajax({type:"POST",url:APP_PATH+"q-and-a/referesh/",data:a,cache:false,dataType:"json",success:function(b){$("#qa-answers").html(b.content)}})};RigBagQa.prototype.advertPrivateReply=function(e){if($(e).valid()){var b=$(e).val();var a=$(".usr-name").val();var i=$(e).attr("data-parent");var g=new Date();var h=g.getTime();var j=$(".adv-id").val();var f='<li class="hide" id="answer-'+h+'">';f=f+'<div class="user">'+a+"</div>";f=f+'<div class="answer">'+b+"</div>";f=f+'<div class="date" date-stamp="'+g.getTime()+'">now';f=f+' &bull; <a href="#" onclick="qaAdvertPrivateDelete( $(this).parent().parent() ); return false;" title="" class="hide remove-2">remove</a>';f=f+"</div>";f=f+"</li>";$("#answers-"+i).append(f);$("#answer-"+h).fadeIn();$(e).val("");var c={qid:i,answer:b,extraType:"advertPrivate"};$.ajax({type:"POST",url:APP_PATH+"q-and-a/answer/",data:c,cache:false,dataType:"json",success:function(d){$("#answer-"+h+" .remove-2").fadeIn();$("#answer-"+h).attr("data-id",d.id)}})}};RigBagQa.prototype.answerSend=function(){if($("#answer").valid()){var a={answer:$("#answer").val(),qid:$("#qid").val()};$.ajax({type:"POST",url:APP_PATH+"q-and-a/answer/",data:a,cache:false,dataType:"json",success:function(b){$("#answer").val("");$("#qa-answers").html(b.content)}})}};RigBagQa.prototype.send=function(b){if($("#formQA").valid()){var c="";c=$("#extraData").val();var a={question:$("#question").val(),circle:$("#questionCircle").val(),extraType:$("#extraType").val(),extraData:c,circleId:b};$.ajax({type:"POST",url:APP_PATH+"q-and-a/add/",data:a,cache:false,dataType:"json",success:function(e){var d;console.log(e);switch($("#extraType").val()){case"advertPrivate":$("#messages-list").html(e.content);d={advertId:c,qaId:e.qaId};sendMail("advertAsk",d);break;case"advertFree":d={advertId:c,qaId:e.qaId};$("#messages-list").html(e.content);sendMail("freeOffer",d);break;case"advertSwap":d={advertId:c,qaId:e.qaId};$("#messages-list").html(e.content);sendMail("swapOffer",d);break;case"advertQuestion":rbApp.callAction("q-and-a/none/0/");break;default:$(".top .nav-right .add").removeClass("active");$("#qa-list").html(e.content);$(".no-items").remove()}$("#question").val("");$(".question-new-form").slideUp();$(".bottom .add-button").removeClass("active")}})}};