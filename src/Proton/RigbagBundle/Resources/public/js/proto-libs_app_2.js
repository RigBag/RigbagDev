function RigBagApp(){this.hash="";this.actionData={};this.action="";this.actionInProgess=false;this.actionStamp=null;this.advert=new RigBagAdvert();this.qa=new RigBagQa();this.user=new RigBagUser();this.circle=new RigBagCircle();this.mySport=new RigBagMySport();this.queryParams={}}RigBagApp.prototype.init=function(){this.getHash();this.parseHash()};RigBagApp.prototype.setActionData=function(a){this.actionData=a};RigBagApp.prototype.getActionData=function(){return this.actionData};RigBagApp.prototype.getHash=function(){this.hash=window.location.hash.substr(1);return this.hash};RigBagApp.prototype.setAction=function(a){this.action=a};RigBagApp.prototype.getAction=function(){return this.action};RigBagApp.prototype.setHash=function(a){window.location.hash="#"+a;this.hash=a};RigBagApp.prototype.mustLoginInit=function(){$(".must-login").attr("onclick","");$(".must-login").click(function(){$("#modalLogin").modal("show");return false})};RigBagApp.prototype.reload=function(){window.location.reload()};RigBagApp.prototype.callAction=function(action,callback){$(".question-new-form").slideUp();if($("#flash-message").length){$("#flash-message").fadeOut(function(){$(this).remove()})}this.actionStamp=new Date().getTime();data=this.getActionData();data.actionStamp=this.actionStamp;showLoader();$.ajax({type:"POST",url:APP_PATH+action,data:data,cache:false,dataType:"json",success:function(data){if(data.actionStamp==rbApp.actionStamp){hideLoader();rbApp.postAction(data)}if(callback!==undefined){eval(callback)}},error:function(data){hideLoader();rbApp.showFlash("",data.status+" "+data.statusText,"error",0)}})};RigBagApp.prototype.loadMoreQa=function(b){var a;this.actionStamp=new Date().getTime();data=this.getActionData();data.actionStamp=this.actionStamp;showLoader();if(b==="mode"){a="advert/more/"}else{a="q-and-a/more/"}$.ajax({type:"POST",url:APP_PATH+a,data:data,cache:false,dataType:"json",success:function(c){if(c.actionStamp==rbApp.actionStamp){hideLoader();if(c.full===0){$(".load-more").addClass("hide")}$("#qa-list ul").append(c.content)}},error:function(c){hideLoader();rbApp.showFlash("",c.status+" "+c.statusText,"error",3000)}})};RigBagApp.prototype.loadMoreAdverts=function(b){var a;this.actionStamp=new Date().getTime();data=this.getActionData();data.actionStamp=this.actionStamp;showLoader();switch(b){case"mode":a="advert/more/";break;case"circle":a="circles/more/adverts/";break}$.ajax({type:"POST",url:APP_PATH+a,data:data,cache:false,dataType:"json",success:function(c){if(c.actionStamp==rbApp.actionStamp){hideLoader();if(c.full===0){$(".load-more").addClass("hide")}$("#adverts-list").append(c.content)}},error:function(c){hideLoader();rbApp.showFlash("",c.status+" "+c.statusText,"error",3000)}})};RigBagApp.prototype.postAction=function(a){this.fillData(a);this.updateInterface()};RigBagApp.prototype.updateInterface=function(){};RigBagApp.prototype.fillData=function(c){$(document).unbind("scroll");for(var b in c.toUpdate){switch(c.toUpdate[b]){case"headerExtras":$("#headerExtras").html(c.header.extras);break;case"headerExtras-2":$("#headerExtras-2").html(c.header.extras2);break;case"headerTop":$("#headerTop").html(c.header.top);break;case"headerBottom":$("#headerBottom").html(c.header.bottom);break;case"content":$("#content").html(c.content);break;case"bodyClass":$("body").attr("class",c.bodyClass);break;case"subContent":$("#sub-content").html(c.subContent);break;case"flashMessage":if(c.flashMessage){this.showFlash(c.flashMessage.title,c.flashMessage.content,c.flashMessage.type,0)}break;case"circleContent":$("#circle-content").html(c.content);break;case"circleContentClass":$("#circle-content").attr("class",c.contentClass);break}}};RigBagApp.prototype.parseHash=function(){var a=this.hash.split("/");this.queryParams=null;$(".sidebar .menu li").removeClass("active");switch(a[1]){case"news":$(".sidebar .menu li.news").addClass("active");if(a[2]==="list"){this.callAction("news/list/")}break;case"signup":$(".sidebar .menu li.settings").addClass("active");switch(a[2]){case"profile":this.callAction("signup/profile/");break;case"mysports":this.callAction("signup/mysports/");break;case"subscription":this.callAction("signup/subscription/");break;case"done":this.callAction("signup/done/");break}break;case"g":$(".sidebar .menu li.adverts").addClass("active");break;case"adverts":$(".sidebar .menu li.adverts").addClass("active");switch(a[2]){case"buy":this.callAction("advert/buy/"+a[3]+"/");break;case"list":this.callAction("advert/list/"+a[3]+"/");break;case"view":this.callAction("advert/view/"+a[3]+"/h/");break;case"search":break;case"add":if(a[3]==="circle"){this.callAction("advert/add/?circles="+a[4])}else{this.callAction("advert/add/")}break;case"edit":this.callAction("advert/edit/"+a[3]+"/");break}break;case"circles":$(".sidebar .menu li.circles").addClass("active");if(a[2]==="list"){this.callAction("circles/0/")}else{if(a[2]=="browse"){this.callAction("circles/browse/")}else{switch(a[3]){case"adverts":if($("#circle-content").length){this.callAction("circles/adverts/"+a[2]+"/simple/")}else{this.callAction("circles/adverts/"+a[2]+"/full/")}break;case"qa":if($("#circle-content").length){this.callAction("circles/qa/"+a[2]+"/simple/")}else{this.callAction("circles/qa/"+a[2]+"/full/")}break;case"members":if($("#circle-content").length){this.callAction("circles/members/"+a[2]+"/simple/")}else{this.callAction("circles/members/"+a[2]+"/full/")}break}}}break;case"qa":$(".sidebar .menu li.qa").addClass("active");switch(a[2]){case"list":this.callAction("q-and-a/none/0/");break;case"add":this.callAction("q-and-a/op/1/");break;case"view":this.callAction("q-and-a/view/"+a[3]+"/");break}break;case"profile":if(a[2]==this.user.id){$(".sidebar .menu li.my-profile").addClass("active")}switch(a[3]){case"adverts":this.callAction("profile/"+a[2]+"/");break;case"circles":switch(a[4]){case"join":if($("body").hasClass("my-profile")){this.callAction("circles/join/simple/")}else{this.callAction("circles/join/full/")}break;case"list":if($("body").hasClass("my-profile")){this.callAction("profile/circles/"+a[2]+"/simple/")}else{this.callAction("profile/circles/"+a[2]+"/full/")}break}break;case"qa":if($("body").hasClass("my-profile")){this.callAction("profile/qa/"+a[2]+"/simple/")}else{this.callAction("profile/qa/"+a[2]+"/full/")}break;default:this.callAction("profile/");$(".sidebar .menu li.my-profile").addClass("active")}break;case"news":$(".sidebar .menu li.news").addClass("active");break;case"settings":$(".sidebar .menu li.settings").addClass("active");switch(a[2]){case"profile":if(a[3]=="reload"){this.callAction("settings/?r=1")}else{this.callAction("settings/")}break;case"mysports":this.callAction("settings/my-sports/");break;case"transactions":this.callAction("profile/transactions/");break;case"subscription":this.callAction("profile/subscription/");break}break;default:$(".sidebar .menu li.adverts").addClass("active");this.callAction("advert/list/sale/")}};RigBagApp.prototype.showFlash=function(a,e,d,b){$("#flash-message").remove();var c='<div id="flash-message" class="alert alert-block';if(d=="success"){c=c+" alert-success"}else{if(d=="error"){c=c+" alert-error"}else{if(d=="info"){c=c+" alert-info"}}}c=c+'">';c=c+'<button type="button" class="close" data-dismiss="alert">Ã—</button>';if(a.length){c=c+"<h4>"+a+"</h4>"}c=c+e;c=c+"</div>";$(".container .content .body").prepend(c);if(b){setTimeout("rbApp.hideFlash()",b)}};RigBagApp.prototype.hideFlash=function(){$("#flash-message").fadeOut(function(){$(this).remove()})};