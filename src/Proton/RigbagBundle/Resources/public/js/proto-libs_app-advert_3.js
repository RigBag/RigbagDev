RigBagAdvert=function(){this.searchParams={query:"",lastCall:false}};RigBagAdvert.prototype.sendToFriend=function(){if($("#formToFriend").valid()){showLoader();var a={advertId:$("#tf-advert-id").val(),message:$("#tf-message").val(),emails:$("#tf-emails").val()};$.ajax({type:"POST",url:APP_PATH+"advert/suggest-to-friend/",data:a,cache:false,dataType:"json",success:function(b){$("#tf-message").val("");$(".to-friend-form").slideUp();hideLoader()}})}};RigBagAdvert.prototype.freeAccept=function(b){showLoader();var a={freeId:b};$.ajax({type:"POST",url:APP_PATH+"free/accept/",data:a,cache:false,dataType:"json",success:function(d){hideLoader();$("#messages-list").html(d.content);sendMail("freeAccepted",a)}})};RigBagAdvert.prototype.swapAccept=function(b){showLoader();var a={swapId:b};$.ajax({type:"POST",url:APP_PATH+"swap/accept/",data:a,cache:false,dataType:"json",success:function(d){hideLoader();$("#messages-list").html(d.content);sendMail("swapAccepted",a)}})};RigBagAdvert.prototype.freeReject=function(b){showLoader();var a={freeId:b};$.ajax({type:"POST",url:APP_PATH+"free/reject/",data:a,cache:false,dataType:"json",success:function(d){hideLoader();$("#messages-list").html(d.content);sendMail("freeRejected",a)}})};RigBagAdvert.prototype.swapReject=function(b){showLoader();var a={swapId:b};$.ajax({type:"POST",url:APP_PATH+"swap/reject/",data:a,cache:false,dataType:"json",success:function(d){hideLoader();$("#messages-list").html(d.content);sendMail("swapRejected",a)}})};RigBagAdvert.prototype.renderForm=function(){switch($(".f-mode").val()){case"sale":$(".f-name").addClass("required");$(".f-price").addClass("required");$(".f-price").addClass("number");$(".f-swap-for").removeClass("required");$(".only-swap, .only-freebie").hide();$(".only-sale").show();break;case"swap":$(".f-name").removeClass("required");$(".f-price").removeClass("required");$(".f-price").removeClass("number");$(".f-swap-for").addClass("required");$(".only-sale, .only-freebie").hide();$(".only-swap").show();break;case"freebie":$(".f-name").removeClass("required");$(".f-swap-for").removeClass("required");$(".f-price").removeClass("required");$(".f-price").removeClass("number");$(".only-swap, .only-sale").hide();$(".only-freebie").show();break}this.renderPreview()};RigBagAdvert.prototype.renderPreview=function(){var a;var d=$(".f-name").val();var m=28;var j=$(".f-price").val();var k=$("#dropdown-currency .value").html();var h=$(".f-location-formated").val().split(", ");var n="";var p="";var i=" for ";var e=0;var f="";if(h.length){c=h.length-1;for(var l=c;l>c-2;l--){if(l>=0){if(n){n=", "+n}n=h[l]+n}}}switch($(".f-mode").val()){case"sale":a="FOR SALE";p="";break;case"swap":a="SWAP";p=$(".f-swap-for").val();break;case"freebie":a="FREEBIE";p="";break}var g="";f=f+a;f=f+d;g=g+'<span class="label-action">';g=g+a;g=g+"</span>";g=g+' <span class="label-important">'+d+"</span>";if($(".f-mode").val()=="swap"&&p.length){f=f+i+p;g=g+i+'<span class="label-important">'+p+"</span>"}g=g+"<br/>";g=g+$("#dropdown-condition .value").html();f=f+$("#dropdown-condition .value").html();if($(".f-mode").val()=="sale"){if(parseInt(j,10)){f=f+j+k;g=g+", ";g=g+j+" "+k}}if(n.length){f=f+n;g=g+", ";g=g+n}g=g+'<br/><a href="#" onclick="return false;">rigbag.com/a/skdj8930933</a>';var o=parseInt($("#maxLength").val(),10)-parseInt(f.length,10);if(o>=0){$(".chars-left").html(o+" characters left");$(".chars-left").removeClass("error");$("#tooLong").val("0")}else{$(".chars-left").html(o+" characters left");$(".chars-left").addClass("error");$("#tooLong").val("1")}$(".preview").html(g)};RigBagAdvert.prototype.search=function(){$(document).unbind("scroll");var b,d;if(!$("body").hasClass("circles")){b="main";d={query:$("#searchQuery").val(),category:$("#searchCategory").val(),mode:$("#headerBottom ul .active").attr("data-type"),type:"main"}}else{b="circle";d={query:$("#searchQuery2").val(),category:$(".circles-sidebar li.active").attr("data-id"),type:"circle"}}rbApp.actionStamp=new Date().getTime();d.actionStamp=rbApp.actionStamp;var a=false;if(d.query.length>2){a=true}else{if(this.searchParams.query.length>d.query.length&&this.searchParams.lastCall){a=true}}if(a){showLoader();this.searchParams.lastCall=a;this.searchParams.query=d.query;$.ajax({type:"POST",url:APP_PATH+"advert/search/",data:d,cache:false,dataType:"json",success:function(e){if(e.actionStamp==rbApp.actionStamp){rbApp.fillData(e)}}});hideLoader()}};RigBagAdvert.prototype.remove=function(){var a={advertId:$(".adv-id").val()};showLoader();$.ajax({type:"POST",url:APP_PATH+"advert/delete/",data:a,cache:false,dataType:"json",success:function(b){if(b.success){setUrl("/adverts/list/"+b.mode+"/")}}})};RigBagAdvert.prototype.close=function(){var a={advertId:$(".adv-id").val()};showLoader();$.ajax({type:"POST",url:APP_PATH+"advert/close/",data:a,cache:false,dataType:"json",success:function(b){if(b.success){setUrl("/adverts/view/"+b.hash+"/")}}})};RigBagAdvert.prototype.socialPublish=function(b,d){var a={advertId:b,social:d};showLoader();$.ajax({type:"POST",url:APP_PATH+"advert/social/publish/",data:a,cache:false,dataType:"json",success:function(e){rbApp.showFlash(e.flashMessage.title,e.flashMessage.content,e.flashMessage.type,0)}});hideLoader()};RigBagAdvert.prototype.post=function(){showLoader();var a=[];var e=[];$(".user-circles .selected").each(function(){a.push($(this).attr("data-id"))});$(".social-connect li.connected").each(function(){e.push($(this).attr("data-type"))});if($("#formAdvert").valid()&&$("#tooLong").val()=="0"&&a.length){var b={id:$(".f-id").val(),title:$(".f-name").val(),description:$(".f-description").val(),condition:$(".f-condition").val(),currency:$(".f-currency").val(),mode:$(".f-mode").val(),location:$(".f-location").val(),locationFormated:$(".f-location-formated").val(),locationLng:$(".f-location-lng").val(),locationLat:$(".f-location-lat").val(),price:$(".f-price").val(),swapFor:$(".f-swap-for").val(),payPal:$(".f-paypal").val(),circles:a,social:e};showLoader();$.ajax({type:"POST",url:APP_PATH+"advert/save/",data:b,cache:false,dataType:"json",success:function(f){setUrl("/adverts/list/"+$(".f-mode").val()+"/");hideLoader()}})}else{var d="";if($("#tooLong").val()=="1"){d=d+"&bull; Advert is too long<br/>"}if(!a.length){d=d+"&bull; Please select circle"}if(d.length){$("#msg-view").html('<div class="alert alert-error">'+d+"</div>");$("#msg-view").show()}else{$("#msg-view").hide()}}};